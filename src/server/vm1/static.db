{ UID: uid-459e-4ba6-0b4b-5786
  Rules: uid-26ce-5542-6e51-2ef4
  is: queryable license contact list
  title: "Restricted view of licenses"
  querying: uid-b712-2250-dac0-a228
}

{ UID: uid-26ce-5542-6e51-2ef4
  is: contact list rule
  when: "query posted, grab it and begin response"
  Alerted: { is: contact query list: @ }
  response: # => {
    UID: new
    Rules: uid-945c-ebd9-3dd4-eb5c uid-38d3-faad-466c-6d8c
    is: contact list
    title: "Restricted query results"
    query: @Alerted
    querying: uid-459e-4ba6-0b4b-5786
  }
}

{ UID: uid-38d3-faad-466c-6d8c
  is: contact list rule
  when: "query notified, get results and notify back"
  querying: { querying: { list: maybe @match } }
  list: => @=querying:querying:list cut-out { email: * }
  content-count: => count @list
  Notifying: => @. with @query
}

{ UID: uid-b712-2250-dac0-a228
  Rules: uid-893a-d617-3dab-16e3
  is: queryable license contact list
  title: "Internal list of licences"
  list:
    uid-0461-a7e5-636f-a0c3
    uid-5b80-c7cd-d680-42ae
    uid-688f-cc96-a532-707f
}

{ UID: uid-893a-d617-3dab-16e3
  is: contact list rule
  when: "query posted, grab it and begin response"
  Alerted: { is: contact query list: @ }
  response: # => {
    UID: new
    Rules: uid-945c-ebd9-3dd4-eb5c uid-c739-64e6-c38c-3ff9
    is: contact list
    title: "Query results"
    query: @Alerted
    querying: uid-b712-2250-dac0-a228
  }
}

{ UID: uid-945c-ebd9-3dd4-eb5c
  is: contact list rule
  when: "query notified, set up match"
  match: => @query cut-out { is: query list: * user: * }
}

{ UID: uid-c739-64e6-c38c-3ff9
  is: contact list rule
  when: "query notified, get results and notify back"
  querying: { list: maybe @match }
  list: => @=querying:list
  content-count: => count @list
  Notifying: => @. with @query
}

{ UID: uid-0461-a7e5-636f-a0c3
  is: license contact
  full-name: "Joe"
  email: joe@here.com
  license-number: 1111-1111
}

{ UID: uid-5b80-c7cd-d680-42ae
  is: license contact
  full-name: "Sam"
  email: sam@there.com
  license-number: 2222-2222
}

{ UID: uid-688f-cc96-a532-707f
  is: license contact
  full-name: "Bob"
  email: bob@here.com
  license-number: 3333-3333
}

{ UID: uid-26bc-8ee9-5443-851a
  Rules: uid-16f2-2db0-e9fe-1d7d
  is: demo editable
  title: Demo
  x: Hello
  y: World
}

{ UID: uid-16f2-2db0-e9fe-1d7d
  is: demo rule editable
  when: "run set title to join of x and y"
  title: => join " " ( @x @y )
}

{ UID: uid-8ed3-ee4a-eeef-0313
  Rules: uid-e85e-7755-1593-0665 uid-c287-63cf-9c45-1f9f uid-4709-6676-f0e2-8054
  is: editable mars rover
  title: Mars Rover
  commands: L M R R M
  coordinates: 0 0
  orientation: 0 1
}

{ UID: uid-e85e-7755-1593-0665
  is: editable mars rover rule
  when: L command, turn left
  commands: ( L => # ) **
  orientation: => @. v.m ( ( 0 -1 ) ( 1 0 ) )
}

{ UID: uid-c287-63cf-9c45-1f9f
  is: editable mars rover rule
  when: R command, turn right
  commands: ( R => # ) **
  orientation: => @. v.m ( ( 0 1 ) ( -1 0 ) )
}

{ UID: uid-4709-6676-f0e2-8054
  is: editable mars rover rule
  when: M command, move forward
  commands: ( M => # ) **
  coordinates: => @. v+v @orientation
}

{ UID: uid-0112-09a9-3f54-b720
  Rules: uid-5f5d-6d29-64d8-2d8c uid-b3ae-5b55-65ad-a296 uid-701d-7264-39b3-ad65 uid-5c83-67b4-2edf-1474
  is: attendable event
  title: "Geek Speak December"
  text: "Europe's Top Tech"
  start: "Wed 12 Dec 2012 18:00:00 GMT"
  end:   "Wed 12 Dec 2012 23:00:00 GMT"
  list: uid-3e0e-a630-b669-23d7 uid-0a01-cec7-61b7-a770
}

{ UID: uid-3e0e-a630-b669-23d7
  Rules: uid-f885-d373-af3a-cb8d uid-e006-8ce3-054a-8158 uid-c435-22f4-7938-6d4f uid-fbad-2ac9-f645-6c87
  is: reviewable event
  title: "My Love of Clojure"
  text: "Long ago, I fell in love with Lisp.."
  start: "Wed 12 Dec 2012 18:00:00 GMT"
  end:   "Wed 12 Dec 2012 19:00:00 GMT"
  within: uid-0112-09a9-3f54-b720
  review-template: {
      email:      { input: textfield label: "Your Email:" }
      comments:   { input: textfield label: "Comments:" }
      pres-style: { input: rating    label: "Presentation Style:" }
  }
}

{ UID: uid-0a01-cec7-61b7-a770
  Rules: uid-f885-d373-af3a-cb8d uid-e006-8ce3-054a-8158 uid-c435-22f4-7938-6d4f uid-fbad-2ac9-f645-6c87
  is: reviewable event
  title: "My Love of FORTRAN"
  text: "Back when I were a lad .."
  start: "Wed 12 Dec 2012 19:00:00 GMT"
  end:   "Wed 12 Dec 2012 20:00:00 GMT"
  within: uid-0112-09a9-3f54-b720
  review-template: {
      email:      { input: textfield label: "Your Email:" }
      comments:   { input: textfield label: "Comments:" }
      pres-style: { input: rating    label: "Presentation Style:" }
  }
}

{ UID: uid-5f5d-6d29-64d8-2d8c
  is: attendable event rule
  when: "rsvp attending received ensure user is in attendees"
  Alerted: { is: rsvp event: @ attending: yes }
  attendees: => @. with @Alerted
}

{ UID: uid-b3ae-5b55-65ad-a296
  is: attendable event rule
  when: "rsvp not attending ensure user not in attendees"
  attendees: { attending: no } => #
}

{ UID: uid-701d-7264-39b3-ad65
  is: event rule
  when: "reviews of sub-events change, calculate average rating"
  list: { rating: number }
  rating: => ( + @list:rating ) / ( count @list:rating )
}

{ UID: uid-5c83-67b4-2edf-1474
  is: editable event rule
  when: "anything changes, pick an email at random"
  list: { contest-selection: * }
  text: => join "\n" ( "Europe's Top Tech" "Contest winner:" ( @=list:contest-selection select ( random 0 ( ( count @=list ) - 1 ) ) ) )
}

{ UID: uid-f885-d373-af3a-cb8d
  is: reviewable event rule
  when: "rsvp review received ensure user is in reviews"
  Alerted: { is: rsvp event: @ within: { attending: yes } }
  reviews: => @. with @Alerted
}

{ UID: uid-e006-8ce3-054a-8158
  is: reviewable event rule
  when: "rsvp not attending ensure user not in reviews"
  reviews: { within: { attending: no } } => #
}

{ UID: uid-c435-22f4-7938-6d4f
  is: reviewable event rule
  when: "review changes, calculate average rating"
  reviews: { rating: number }
  rating: => ( + @reviews:rating ) / ( count @reviews:rating )
}

{ UID: uid-fbad-2ac9-f645-6c87
  is: editable event rule
  when: "anything changes, pick an email at random"
  reviews: { email: * }
  contest-selection: => @=reviews:email select ( random 0 ( ( count @=reviews ) - 1 ) )
}

