{ "%uid": "uid-c102-dd84-8284-c360",
  "%class": "netmash.forest.ObjectMash",
  "%rules": [ "uid-c265-091b-418c-c329" ],
  "is": [ "gui" ],
  "title": "CAP Payments Demo",
  "view": { "logo": "http://www.shaunthesheep.be/shaunthesheep/foto/500/thefarmer-1.jpg",
            "text": "Welcome to the Farmer Support Agency!",
            "start": { "input": "button", "label": "Apply for farming support" },
            "info": [ { "is":"style", "direction":"horizontal", "proportions":"75%" },
                      "CAP Info:", "http://ec.europa.eu/agriculture/cap-post-2013/index_en.htm" ]
  }
}

{ "%uid": "uid-c265-091b-418c-c329",
  "is": [ "gui", "rule" ],
  "when": "form submitted, create application",
  "%alerted": { "is": "form" },
  "applications": [ [ { "form": "$:%alerted" } ], "!=>", "has",
    { "%uid": "new",
      "%rules": [ "uid-f265-941d-a0b8-ca5d", "uid-1cc7-4c21-9036-4e01", "uid-872c-b29e-03a1-7b61", "uid-9ce9-1bdd-ec05-c8fa" ],
      "is": [ "gui" ],
      "title": "CAP application",
      "form": "$:%alerted",
      "view": {
        "title": "CAP Application",
        "user": [ "style", "You:", "$:%alerted:user" ]
      }
    }
  ]
}

{ "%uid": "uid-f265-941d-a0b8-ca5d",
  "is": [ "gui", "rule" ],
  "when": "application created, create land list",
  "%notifying": [ "=>", "has", "$:form" ],
  "view": {
    "land": [ "#", "=>", "style", "Your Land:",
      { "%uid": "new",
        "%rules": [ "uid-0215-038b-7558-041a" ],
        "is": [ "updatable", "land", "list" ],
        "list": [],
        "template": "uid-5c78-11ee-a3c7-ba89"
      }
    ]
  }
}

{ "%uid": "uid-5c78-11ee-a3c7-ba89",
  "%rules": [ "uid-0215-038b-7558-041a" ],
  "is": [ "updatable", "land" ],
  "usage":       { "input": "chooser",   "label": "Land Usage:", "range": [
    "Annex I Products", "Maintaining for grazing/cultivation",
    "Permanent Grassland", "Permanent Crops",
    "Nurseries", "Short-Rotation Coppice", "Fallow" ]
  },
  "entitlement": { "input": "textfield", "label": "Entitlement Ref:" },
  "active":      { "input": "checkbox",  "label": "Confirm Actively Farmed", "value": false },
  "cap-info":    { "style": { "is":"style", "direction":"horizontal", "proportions":"75%" },
                   "text": "CAP Info:", "link": "http://ec.europa.eu/agriculture/cap-post-2013/index_en.htm" },
  "template": "uid-9da2-71f4-4a2f-f389"
}

{ "%uid": "uid-9da2-71f4-4a2f-f389",
  "is": "land",
  "usage":       { "input": "chooser",   "label": "Land Usage:", "range": [
    "Permanent (e.g. farmhouse)", "River",
    "Woodland", "Polytunnel on Concrete" ]
  },
  "ineligible":  { "input": "checkbox",  "label": "Ineligible Feature", "value": false },
  "cap-info":    { "style": { "is":"style", "direction":"horizontal", "proportions":"75%" },
                   "text": "CAP Info:", "link": "http://ec.europa.eu/agriculture/cap-post-2013/index_en.htm" }
}

{ "%uid": "uid-1cc7-4c21-9036-4e01",
  "is": [ "gui", "rule" ],
  "when": "application created, create payment object",
  "view": {
    "cash": [ "#", "=>", "style", "Your Estimated Payment:", 0 ]
  },
  "payment": [ "#", "=>",
      { "%uid": "new",
        "%rules": [ "uid-e683-5ee2-a986-b93b", "uid-d958-bf42-c730-8406", "uid-73ec-5ea1-9cf0-dfa5" ],
        "is": [ "payment" ],
        "land": "$:view:land:2",
        "constants": "uid-2433-fd91-25ad-2e9b"
      }
  ]
}

{ "%uid": "uid-2433-fd91-25ad-2e9b",
  "is": [ "look-up" ],
  "title": "CAP Payments Constants",
  "payment-per-ha": 100,
  "minimum-payout": 200,
  "maximum-payout": 300000
}

{ "%uid": "uid-872c-b29e-03a1-7b61",
  "is": [ "gui", "rule" ],
  "when": "gui built, set up its styles",
  "view": { "style": [ "#", "=>", { "is": "style", "colours":"lightgreen" } ],
            "user": [ [ "style", "=>", { "is":"style", "direction":"horizontal", "proportions":"75%" } ] ],
            "land": [ [ "style", "=>", { "is":"style", "direction":"horizontal", "proportions":"75%" } ] ],
            "cash": [ [ "style", "=>", { "is":"style", "direction":"horizontal", "proportions":"50%", "colours":"lightblue" } ] ]
  }
}

{ "%uid": "uid-0215-038b-7558-041a",
  "is": [ "land", "rule" ],
  "when": "land object notified, add to list",
  "%alerted": { "is": "land", "place": "*" },
  "list": [ [ "$:%alerted" ], "!=>", "has", "$:%alerted" ]
}

{ "%uid": "uid-e683-5ee2-a986-b93b",
  "is": [ "payment", "rule" ],
  "when": "eligible land seen, calculate claimable area and multiply by payment per hectare",
  "land": { "list": [ { "area": "*", "usage": "*", "entitlement": "*", "active": true } ] },
  "payment": [ "=>", [ "+", "$::land:list:area" ], "*", "$:constants:payment-per-ha" ]
}

{ "%uid": "uid-d958-bf42-c730-8406",
  "is": [ "payment", "rule" ],
  "when": "basic payment calculated, if less than min, set to zero",
  "payment": [ [ "<", "$:constants:minimum-payout" ], "=>", 0 ]
}

{ "%uid": "uid-73ec-5ea1-9cf0-dfa5",
  "is": [ "payment", "rule" ],
  "when": "basic payment calculated, set maximum (not the complete progression)",
  "payment": [ [ ">", "$:constants:maximum-payout" ], "=>", "$:constants:maximum-payout" ]
}

{ "%uid": "uid-9ce9-1bdd-ec05-c8fa",
  "is": [ "gui", "rule" ],
  "when": "payment updates, show it",
  "view": { "cash": [ "*", "*", [ "=>", "$:payment:payment" ] ] }
}

