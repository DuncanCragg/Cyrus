{ "%uid": "uid-c102-dd84-8284-c360",
  "%class": "netmash.forest.ObjectMash",
  "%rules": [ "uid-c265-091b-418c-c329" ],
  "is": [ "gui" ],
  "title": "CAP Payments Demo",
  "view": { "#start": { "input": "button", "label": "Apply for farming support" }
  }
}

{ "%uid": "uid-c265-091b-418c-c329",
  "is": [ "gui", "rule" ],
  "when": "form submitted, create application",
  "%alerted": { "is": "form" },
  "applications": [ [ { "form": "$:%alerted" } ], "!=>", "has",
    { "%uid": "new",
      "%rules": [ "uid-f265-941d-a0b8-ca5d", "uid-1cc7-4c21-9036-4e01", "uid-9ce9-1bdd-ec05-c8fa" ],
      "is": [ "gui" ],
      "title": "CAP application",
      "form": "$:%alerted",
      "view": {
        "style": { "is": "style", "colours":"lightgreen" },
        "#title": "CAP Application",
        "#user": [ { "is": "style", "direction": "horizontal", "options": "jump", "proportions": "75%" },
          "You:", "$:%alerted:user"
        ]
      }
    }
  ]
}

{ "%uid": "uid-f265-941d-a0b8-ca5d",
  "is": [ "gui", "rule" ],
  "when": "application created, create land list",
  "%notifying": [ "=>", "has", "$:form" ],
  "view": {
    "#land": [ "#", "=>", { "is": "style", "direction": "horizontal", "options": "jump", "proportions": "75%" },
      "Your Land:",
      { "%uid": "new",
        "%rules": [ "uid-0215-038b-7558-041a" ],
        "is": [ "updatable", "land", "list" ],
        "template": { "is": "land",
                      "usage":       { "input": "chooser",   "label": "Land Usage:", "range": [
                                            "Annex I Products (CN-Coded / CN-chapter 22)",
                                            "Maintaining for grazing/cultivation",
                                            "Permanent Grassland", "Permanent Crops",
                                            "Nurseries", "Short-Rotation Coppice", "Fallow"
                      ] },
                      "entitlement": { "input": "textfield", "label": "Entitlement Ref:" },
                      "active":      { "input": "checkbox",  "label": "Confirm Actively Farmed", "value": false },
                    },
        "list": []
      }
    ]
  }
}

{ "%uid": "uid-1cc7-4c21-9036-4e01",
  "is": [ "gui", "rule" ],
  "when": "application created, create payment object",
  "view": {
    "#payment": [ "#", "=>", { "is":"style", "direction":"horizontal", "colours":"lightblue", "proportions": "50%" },
      "Your Estimated Payment:", 0
    ]
  },
  "payment": [ "#", "=>",
      { "%uid": "new",
        "%rules": [ "uid-e683-5ee2-a986-b93b", "uid-d958-bf42-c730-8406" ],
        "is": [ "payment" ],
        "land": "$:view:#land:2",
        "payment-per-ha": 100,
        "minimum-payout": 200
      }
  ]
}

{ "%uid": "uid-0215-038b-7558-041a",
  "is": [ "land", "list", "rule" ],
  "when": "land object notified, add to list",
  "%alerted": { "is": "land", "place": "*" },
  "list": [ [ "$:%alerted" ], "!=>", "has", "$:%alerted" ]
}

{ "%uid": "uid-e683-5ee2-a986-b93b",
  "is": [ "payment", "rule" ],
  "when": "eligible land seen, calculate claimable area and multiply by payment per hectare",
  "land": { "list": [ { "area": "*", "usage": "*", "entitlement": "*", "active": true } ] },
  "payment": [ "=>", [ "+", "$::land:list:area" ], "*", "$:payment-per-ha" ]
}

{ "%uid": "uid-d958-bf42-c730-8406",
  "is": [ "payment", "rule" ],
  "when": "basic payment calculated, if less than min, set to zero",
  "payment": [ [ "<", "$:minimum-payout" ], "=>", 0 ]
}

{ "%uid": "uid-9ce9-1bdd-ec05-c8fa",
  "is": [ "gui", "rule" ],
  "when": "payment updates, show it",
  "view": { "#payment": [ "*", "*", [ "=>", "$:payment:payment" ] ] }
}

